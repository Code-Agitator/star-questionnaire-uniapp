"use strict";var e=Object.defineProperty,r=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(r,t,o)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o,s=(e,r)=>{var t={};for(var l in e)n.call(e,l)&&r.indexOf(l)<0&&(t[l]=e[l]);if(null!=e&&o)for(var l of o(e))r.indexOf(l)<0&&i.call(e,l)&&(t[l]=e[l]);return t};const a=require("../../../../common/vendor.js");Math||c();const c=()=>"../cellgroup/cellgroup.js",u=`${a.PREFIX}-form`,p=a.defineComponent({name:u,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),m=a.defineComponent((d=((e,r)=>{for(var t in r||(r={}))n.call(r,t)&&l(e,t,r[t]);if(o)for(var t of o(r))i.call(r,t)&&l(e,t,r[t]);return e})({},p),f={props:a.formProps,emits:a.formEmits,setup(e,{expose:r,emit:t}){const o=e,n=t;r({reset:function(){p()},submit:function(){return v(),!1},validate:v});const i=a.computed((()=>a.reactive({}))),{internalChildren:l}=a.useProvide(a.FORM_KEY,"nut-form-item")({props:o,formErrorTip:i}),c=a.computed((()=>a.getMainClass(o,u)));function p(){Object.keys(i.value).forEach((e=>{i.value[e]=""}))}function m(e){let r=[];return e.forEach((e=>{var t,o,n,i;let l=e.type;l=l.name||l,"nut-form-item"===l||(null==l?void 0:l.toString().endsWith("form-item"))?r.push({prop:null==(t=e.props)?void 0:t.prop,rules:(null==(o=e.props)?void 0:o.rules)||[]}):Array.isArray(e.children)&&(null==(n=e.children)?void 0:n.length)?r=r.concat(m(e.children)):a.isObject(e.children)&&Object.keys(e.children)?(null==(i=e.children)?void 0:i.default)&&(e.children=e.children.default(),r=r.concat(m(e.children))):Array.isArray(e)&&(r=r.concat(m(e)))})),r}function d(e){e.message&&n("validate",e),i.value[e.prop]=e.message}function f(e){return r=this,t=null,n=function*(){const{rules:r,prop:t}=e,n=e=>new Promise(((r,t)=>{try{d(e),r(e)}catch(o){t(o)}}));t||console.warn("[NutUI] <FormItem> 使用 rules 校验规则时 , 必须设置 prop 参数");const i=a.getPropByPath(o.modelValue,t||"");d({prop:t,message:""});const l=o.rules||{},c=[...(null==l?void 0:l[t])||[],...r];for(;c.length;){const e=c.shift(),{validator:r}=e,o=s(e,["validator"]),{required:l,regex:p,message:m}=o,d={prop:t,message:m};if(l)if(Array.isArray(i)){if(!i.length)return n(d)}else if(!i&&0!==i)return n(d);if(p&&!p.test(String(i)))return n(d);if(r){const e=r(i,o);if(a.isPromise(e))try{if(!1===(yield e))return n(d)}catch(u){return n({prop:t,message:u})}else if(!e)return n(d)}}return Promise.resolve(!0)},new Promise(((e,o)=>{var i=e=>{try{s(n.next(e))}catch(r){o(r)}},l=e=>{try{s(n.throw(e))}catch(r){o(r)}},s=r=>r.done?e(r.value):Promise.resolve(r.value).then(i,l);s((n=n.apply(r,t)).next())}));var r,t,n}function v(e=""){return new Promise(((r,t)=>{try{const t=m(null==l?void 0:l.map((e=>e.vnode))).map((r=>e&&e!==r.prop?Promise.resolve(!0):f(r)));Promise.all(t).then((e=>{const t={valid:!0,errors:[]};(e=e.filter((e=>!0!==e))).length&&(t.valid=!1,t.errors=e),r(t)}))}catch(o){t(o)}}))}return a.watch((()=>o.modelValue),(()=>{p()}),{immediate:!0}),(e,r)=>({a:a.n(c.value),b:a.s(e.customStyle),c:a.o((()=>!1))})}},r(d,t(f))));var d,f;wx.createComponent(m);
